@startuml

participant "NS16550\n(COM1/2)" as dev
participant "MochiKernel"       as kernel
participant "drv-ns16550"       as drv
participant mvfs

activate drv
ref over drv
    デバイス割込み待ち合わせ機能
end ref

dev --\ drv: ステータス(LSR)読込み
loop ステータス==受信データ有り

    dev --\ drv: 受信バッファ(RBR)読込み

    opt ステータス!=エラー
        drv -> drv: 受信バッファ追加
    end opt

    dev --\ drv: ステータス(LSR)読込み
end loop

opt 受信バッファ内データ数 > 0
    drv ->> mvfs: 読込みレディ通知
end opt

deactivate drv

@enduml
